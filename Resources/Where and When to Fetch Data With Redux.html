<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Where and When to Fetch Data With Redux</title>
<meta name="description" content="An example using fetch with React and Redux to make API calls, and why the componentDidMount lifecycle hook is the best place to make the call.">
<meta name="keywords" content="react, redux">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Where and When to Fetch Data With Redux">
<meta name="twitter:description" content="An example using fetch with React and Redux to make API calls, and why the componentDidMount lifecycle hook is the best place to make the call.">
<meta name="twitter:site" content="@dceddia">
<meta name="twitter:creator" content="@dceddia">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://daveceddia.com/images/where-fetch-data-redux-twitter.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Where and When to Fetch Data With Redux">
<meta property="og:description" content="An example using fetch with React and Redux to make API calls, and why the componentDidMount lifecycle hook is the best place to make the call.">

<meta property="og:image" content="https://daveceddia.com/images/where-fetch-data-redux.png">

<meta property="og:url" content="https://daveceddia.com/where-fetch-data-redux/">
<meta property="og:site_name" content="Dave Ceddia">





<link href="https://fonts.googleapis.com/css?family=Montserrat:400|PT+Serif:400,400i,700" rel="stylesheet">
<link rel="canonical" href="https://daveceddia.com/where-fetch-data-redux/">
<link href="https://daveceddia.com/feed.xml" type="application/atom+xml" rel="alternate" title="Dave Ceddia Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="fb:admins" content="50205984" />

<meta property="dc:page_id" content="where-fetch-data-redux">

<!-- For all browsers -->
<link rel="stylesheet" type="text/css" href="https://daveceddia.com/assets/css/site.min.css?v=4">




<!-- Webfonts -->

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="https://daveceddia.com/assets/js/vendor/html5shiv.min.js"></script>
  <script src="https://daveceddia.com/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://daveceddia.com/favicon.ico?v=2">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://daveceddia.com/favicon.png?v=2">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://daveceddia.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://daveceddia.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://daveceddia.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://daveceddia.com/images/apple-touch-icon-144x144-precomposed.png">


</head>

<body id="post">

<nav role="navigation" id="site-nav">
	<header>
    
		<a href="https://daveceddia.com/" class="site-logo" rel="home" title="Dave Ceddia">
      <img
        src="https://daveceddia.com/images/logo.png"
        srcset="https://daveceddia.com/images/logo@2x.png 2x"
        alt="Dave Ceddia logo"/>
		</a>
    
    <h1 class="site-title"><a href="https://daveceddia.com/">Dave Ceddia</a></h1>
		<h2 class="site-description" itemprop="description">Articles to help you learn and master frontend development with React.</h2>
	</header>
  <ul>
  
    
    <li>
    	<a class="nav-cta" href="https://daveceddia.com/pure-react-email-course/" >Free React Course</a>
    </li>
  
    
    <li>
    	<a  href="https://daveceddia.com/archives/" >All Posts</a>
    </li>
  
    
    <li>
    	<a  href="https://daveceddia.com/about/" >About</a>
    </li>
  
  </ul>
</nav>


<div id="main" role="main">
  <article class="hentry">
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="https://daveceddia.com/tags/#react" title="Pages tagged react">react</a>&nbsp;&bull;&nbsp;<a href="https://daveceddia.com/tags/#redux" title="Pages tagged redux">redux</a></span>
        
          <h1 class="entry-title">Where and When to Fetch Data With Redux</h1>
        
      </header>
      <footer class="entry-meta muted-centered">
        
        <span class="author vcard">By <span class="fn">Dave Ceddia</span></span>
        <span class="entry-date date published"><time datetime="2018-02-02T13:19:57+00:00"><i class="fa fa-calendar-o"></i> February 02, 2018</time></span>
        &nbsp;&mdash; <em>updated <span class="entry-date date modified"><time datetime="2018-07-03 04:12:57 -0400"><i class="fa fa-pencil"></i> July 03, 2018</time></span></em>
        
          <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        
        
        
      </footer>
      <a id="twitter-follow" href="https://twitter.com/intent/follow?screen_name=dceddia" class="twitter-follow-button" target="_blank">
	<i></i> Follow @dceddia</a>


      <div class="entry-content">
        
        <blockquote>
  <p>If a component needs data in order to render, and you want to fetch that data with Redux and keep it in the Redux store, when is the best time to make that API call?</p>
</blockquote>

<p>tl;dr ‚Äì <strong>Kick off the action in the <code class="highlighter-rouge">componentDidMount</code> lifecycle hook</strong></p>

<h2 id="making-api-calls-with-redux">Making API Calls with Redux</h2>

<p>Let‚Äôs imagine you want to display a list of products. You‚Äôve got a backend API that answers to <code class="highlighter-rouge">GET /products</code>, so you create a Redux action to do the fetching:</p>

<div class="code-filename">productActions.js</div>
<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">fetchProducts</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">dispatch</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">(</span><span class="nx">fetchProductsBegin</span><span class="p">());</span>
    <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">"/products"</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">handleErrors</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">json</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">fetchProductsSuccess</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">products</span><span class="p">));</span>
        <span class="k">return</span> <span class="nx">json</span><span class="p">.</span><span class="nx">products</span><span class="p">;</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">fetchProductsFailure</span><span class="p">(</span><span class="nx">error</span><span class="p">)));</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Handle HTTP errors since fetch won't.</span>
<span class="kd">function</span> <span class="nx">handleErrors</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Side note: <strong><code class="highlighter-rouge">fetch()</code> does not throw for HTTP errors like 404s</strong>. This is really confusing if you‚Äôre used to something like <a href="https://github.com/axios/axios">axios</a>. Read <a href="https://www.tjvantoll.com/2015/09/13/fetch-and-errors/">here</a> for more about fetch and error handling.</p>

<h2 id="use-redux-thunk-to-fetch-data-with-redux">Use redux-thunk to Fetch Data with Redux</h2>

<p>Normally, actions must be plain objects. Returning a <em>function</em>, like we‚Äôre doing in <code class="highlighter-rouge">fetchProducts</code>, is outside the ordinary and Redux won‚Äôt allow it. Not without some help, anyway.</p>

<p>That‚Äôs where <code class="highlighter-rouge">redux-thunk</code> comes in. It‚Äôs a <em>middleware</em> which we can add to Redux to effectively teach it how to deal with new kinds of actions. (you can read more about <a href="/what-is-a-thunk/">what a thunk is</a> if you‚Äôre curious)</p>

<div>
  <div class="dc_form_container inline-prec">
    <div class="dc_success_msg" style="display:none;">
      Success! Now check your email.
    </div>

    <!--  Form starts here  -->
    <form class="dc_signup_form" action="/s/signup" method="POST">
      <h4 class="dc_title">
</h4>
      <div class="dc_description">
        
<div>
  <blockquote>
    Waiiit... what now?
    <br />
    <br />
    redux-thunk?! <em>Reducers</em> barely make sense and now I'm pretty sure he's making up words.
  </blockquote>

  <p>If you are riding the slippery edge of Redux understanding, bravely forging ahead despite not being <em>quite</em> sure what's going on... well, I've been there, too. And I've made a thing for you.</p>

  <p>Even if you <em>think</em> you've got it, <em>maybe</em>... <em>probably</em> you'll be fine... this is worth a run-though.</p>

  <p>A 3-day email course designed to get you <em>solid</em> on Redux fundamentals. Actions, reducers, stores, <code>connect</code>, <code>Provider</code>, immutability. (oh, the onslaught of terms we put up with as front end devs).</p>

  <p>You'll have it figured out before the week is done :)</p>

  <p>Drop your email in the box for the first lesson.</p>
</div>

      </div>

      <div class="dc_error_msg" style="display:none">
        There was an error submitting your subscription. Please try again.
      </div>

      <div class="dc_field">
        <label class="dc_label" for="dc_email" style="display: none">Email Address</label>
        <input type="email" name="email" placeholder="Your email address" required="" />
      </div>
      <div class="dc_form_field" style="position: absolute !important;left: -999em !important;">
        <input type="text" name="last_name" />
      </div>
      <input type="hidden" name="page_id" value="where-fetch-data-redux" />
      <input type="hidden" name="form_id" value="thunks-are-confusing" />
      <input type="hidden" name="form_version" value="1" />
      <input type="hidden" name="tag" value="734372" />
      <button class="dc_subscribe_button">
        Get Lesson 1 Now
      </button>
      <div class="dc_guarantee">
        3-day course and an article every week or two.<br />Unsubscribe whenever.
      </div>
    </form>

    <form class="dc_gdpr_form" action="/s/signup/gdpr" method="POST" style="display:none;">
  <p>Before we go on, I have to ask...</p>
  <div class="dc_form_field">
    <label>
      <input type="checkbox" name="confirm_answer" value="true" />
      <span>consent</span>
    </label>
  </div>
  <br />

  <div class="dc_error_msg" style="display:none">
    There was an error submitting your subscription. Please try again.
  </div>

  <input type="hidden" name="email" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="firstName" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="gdpr" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="captcha" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="sign" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="confirm" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="tag" value="734372" />
  <input type="hidden" name="page_id" value="where-fetch-data-redux" />
  <input type="hidden" name="form_id" value="thunks-are-confusing" />
  <input type="hidden" name="form_version" value="1" />
  <button class="dc_subscribe_button">
    Finish
  </button>
</form>

  </div>

  <style type="text/css">
    .dc_form_container {
      border-top: 4px solid #3166de;
      border-bottom: 4px solid #3166de;
      padding: 1em;
      background: #f8faff;
      font-family: "Open Sans", sans-serif;
      margin-bottom: 2.5rem;
    }
    .dc_form_container .dc_title {
      margin-top: 0;
      text-align: center;
      font-weight: 400;
      font-size: 30px;
    }
    .dc_form_container .dc_description {
      margin-bottom: 10px;
    }
    .dc_signup_form, .dc_gdpr_form {
      margin-bottom: 0;
      position: relative;
    }
    .dc_signup_form input, .dc_gdpr_form input {
      width: 100%;
      padding: 20px 12px;
    }
    .dc_gdpr_form input[type="checkbox"] {
      width: initial;
      margin: 0;
      margin-right: 5px;
    }
    .dc_subscribe_button {
      margin: 0 auto;
      display: block;
      width: 100%;
      max-width: 250px;
      font-size: 18px;
      background: orange;
      color: #fff;
      border-color: #e29609;
      height: auto;
      margin-bottom: 5px;
    }
    .dc_subscribe_button[disabled] {
      opacity: 0.5;
    }
    .dc_subscribe_button[disabled]:hover {
      opacity: 0.5;
      color: #fff;
    }
    .dc_guarantee {
      font-size: 12px;
      text-align: center;
      opacity: 0.7;
    }
    .dc_success_msg {
      padding: 10px;
      background: #fff;
      border: 1px solid #8dc74a;
      border-radius: 2px;
      background: #F1F8E9;
      text-align: center;
    }
    .dc_error_msg {
      background: #FFEBEE;
      padding: 10px;
      margin-bottom: 5px;
      border: 2px solid #C62828;
    }
  </style>
</div>

<style>
img.dc_form_img {
  margin: 0 auto;
  margin-bottom: 10px;
}
.prec-bullet {
  margin-left: 15px;
}
.inline-prec.dc_form_container {
  border: none;
}
.inline-prec button {
  max-width: 320px;
}
</style>

<p>You can install redux-thunk with <code class="highlighter-rouge">npm install redux-thunk</code>, and then it takes just a couple lines of setup to extend the Redux store with this new middleware.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">applyMiddleware</span> <span class="p">}</span> <span class="k">from</span> <span class="s2">"redux"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">thunk</span> <span class="k">from</span> <span class="s2">"redux-thunk"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span>
  <span class="nx">rootReducer</span><span class="p">,</span>
  <span class="nx">applyMiddleware</span><span class="p">(</span><span class="nx">thunk</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>The important thing to note about setting up <code class="highlighter-rouge">redux-thunk</code> is that you have to wrap it in <code class="highlighter-rouge">applyMiddleware</code> before passing it to Redux. There‚Äôs also that <code class="highlighter-rouge">rootReducer</code> thing ‚Äì we‚Äôll see where that comes from later on.</p>

<p>This code could live in <code class="highlighter-rouge">index.js</code>, or it could be tucked away in its own file (<code class="highlighter-rouge">store.js</code> is a nice name). Redux doesn‚Äôt care where you put your files. Glom them together if you want. As long as you‚Äôve got a store, and it‚Äôs provided to your app with a <code class="highlighter-rouge">Provider</code> (from <code class="highlighter-rouge">react-redux</code>), you‚Äôre all set.</p>

<h3 id="how-to-name-your-redux-actions">How to Name Your Redux Actions</h3>

<p>Redux actions that fetch data usually come in triplets: BEGIN, SUCCESS, FAILURE. This isn‚Äôt a requirement, it‚Äôs just a convention.</p>

<p><em>Before</em> you start the API call, you dispatch the BEGIN action.</p>

<p>Then <em>after</em> the call succeeds, you dispatch SUCCESS with the data. If it failed instead, you dispatch FAILURE with the error.</p>

<p>Sometimes the last one is called ERROR instead. It‚Äôs not a big deal, just be consistent about it. (like I wasn‚Äôt, when I wrote this post the first time).</p>

<p><strong>Careful</strong>: Dispatching an ERROR action and handling a FAILURE will lead to no end of hair pulling as you trace through your code, realizing the action is dispatching correctly but the data is never updating. Learn from my mistakes :)</p>

<p>This BEGIN/SUCCESS/FAILURE pattern is nice because it gives you hooks to keep track of what‚Äôs happening ‚Äì say, by setting a ‚Äúloading‚Äù flag <code class="highlighter-rouge">true</code> in response to the BEGIN action, and then <code class="highlighter-rouge">false</code> after SUCCESS or FAILURE. Here‚Äôs what those actions look like:</p>

<div class="code-filename">productActions.js</div>
<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">FETCH_PRODUCTS_BEGIN</span>   <span class="o">=</span> <span class="s1">'FETCH_PRODUCTS_BEGIN'</span><span class="p">;</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">FETCH_PRODUCTS_SUCCESS</span> <span class="o">=</span> <span class="s1">'FETCH_PRODUCTS_SUCCESS'</span><span class="p">;</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">FETCH_PRODUCTS_FAILURE</span> <span class="o">=</span> <span class="s1">'FETCH_PRODUCTS_FAILURE'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">fetchProductsBegin</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">type</span><span class="p">:</span> <span class="nx">FETCH_PRODUCTS_BEGIN</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">fetchProductsSuccess</span> <span class="o">=</span> <span class="nx">products</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">type</span><span class="p">:</span> <span class="nx">FETCH_PRODUCTS_SUCCESS</span><span class="p">,</span>
  <span class="na">payload</span><span class="p">:</span> <span class="p">{</span> <span class="nx">products</span> <span class="p">}</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">fetchProductsFailure</span> <span class="o">=</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">type</span><span class="p">:</span> <span class="nx">FETCH_PRODUCTS_FAILURE</span><span class="p">,</span>
  <span class="na">payload</span><span class="p">:</span> <span class="p">{</span> <span class="nx">error</span> <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>And then we‚Äôll have the reducer save the products into the Redux store when it receives the <code class="highlighter-rouge">FETCH_PRODUCTS_SUCCESS</code> action. It‚Äôll also set a <code class="highlighter-rouge">loading</code> flag to true when the fetch begins, and false when it finishes or fails.</p>

<div class="code-filename">productReducer.js</div>
<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span>
  <span class="nx">FETCH_PRODUCTS_BEGIN</span><span class="p">,</span>
  <span class="nx">FETCH_PRODUCTS_SUCCESS</span><span class="p">,</span>
  <span class="nx">FETCH_PRODUCTS_FAILURE</span>
<span class="p">}</span> <span class="k">from</span> <span class="s1">'./productActions'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">initialState</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">items</span><span class="p">:</span> <span class="p">[],</span>
  <span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">error</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">productReducer</span><span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">FETCH_PRODUCTS_BEGIN</span><span class="p">:</span>
      <span class="c1">// Mark the state as "loading" so we can show a spinner or something</span>
      <span class="c1">// Also, reset any errors. We're starting fresh.</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
        <span class="na">loading</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">error</span><span class="p">:</span> <span class="kc">null</span>
      <span class="p">};</span>

    <span class="k">case</span> <span class="nx">FETCH_PRODUCTS_SUCCESS</span><span class="p">:</span>
      <span class="c1">// All done: set loading "false".</span>
      <span class="c1">// Also, replace the items with the ones from the server</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
        <span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">items</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">products</span>
      <span class="p">};</span>

    <span class="k">case</span> <span class="nx">FETCH_PRODUCTS_FAILURE</span><span class="p">:</span>
      <span class="c1">// The request failed. It's done. So set loading to "false".</span>
      <span class="c1">// Save the error, so we can display it somewhere.</span>
      <span class="c1">// Since it failed, we don't have items to display anymore, so set `items` empty.</span>
      <span class="c1">//</span>
      <span class="c1">// This is all up to you and your app though:</span>
      <span class="c1">// maybe you want to keep the items around!</span>
      <span class="c1">// Do whatever seems right for your use case.</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
        <span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">error</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span>
        <span class="na">items</span><span class="p">:</span> <span class="p">[]</span>
      <span class="p">};</span>

    <span class="nl">default</span><span class="p">:</span>
      <span class="c1">// ALWAYS have a default case in a reducer</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Finally, we just need to pass the products into a <code class="highlighter-rouge">ProductList</code> component that will display them, and also be responsible for kicking off the data fetching.</p>

<div class="code-filename">ProductList.js</div>
<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s2">"react"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">connect</span> <span class="p">}</span> <span class="k">from</span> <span class="s2">"react-redux"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">fetchProducts</span> <span class="p">}</span> <span class="k">from</span> <span class="s2">"/productActions"</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">ProductList</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">fetchProducts</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">loading</span><span class="p">,</span> <span class="nx">products</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Error! <span class="si">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Loading...<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">product</span> <span class="o">=&gt;</span>
          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key=</span><span class="si">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">)</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="nx">state</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">products</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span>
  <span class="na">loading</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">loading</span><span class="p">,</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">error</span>
<span class="p">});</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">)(</span><span class="nx">ProductList</span><span class="p">);</span>
</code></pre></div></div>

<p>I‚Äôm referring to the data with <code class="highlighter-rouge">state.products.&lt;whatever&gt;</code> instead of just <code class="highlighter-rouge">state.&lt;whatever&gt;</code> because I‚Äôm making the assumption that you‚Äôll probably have more than one reducer, each handling its own slice of state. To make this work, we can write a <code class="highlighter-rouge">rootReducer.js</code> file that pulls them all together:</p>

<div class="code-filename">rootReducer.js</div>
<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">combineReducers</span> <span class="p">}</span> <span class="k">from</span> <span class="s2">"redux"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">products</span> <span class="k">from</span> <span class="s2">"./productReducer"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">combineReducers</span><span class="p">({</span>
  <span class="nx">products</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Then, when we create our store, we can pass this ‚Äúroot‚Äù reducer:</p>

<div class="code-filename">index.js</div>
<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">rootReducer</span> <span class="k">from</span> <span class="s1">'./rootReducer'</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">rootReducer</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="error-handling-in-redux">Error Handling in Redux</h2>

<p>The error handling here is pretty light, but the basic structure will be the same for most actions that make API calls. The general idea is:</p>

<ol>
  <li>Dispatch a FAILURE action when the call fails</li>
  <li>Handle that FAILURE action in the reducer by setting some kind of flag and/or saving the error message.</li>
  <li>Pass the error flag and the message (if you have one) into components that need to handle errors, and condtionally render the error however you see fit.</li>
</ol>

<h2 id="but-it-will-render-twice">But It Will Render Twice!</h2>

<p>This is a really common concern. And yes, it <em>will</em> render more than once.</p>

<p>It will render in an empty state, then re-render in a loading state, and then re-render <em>again</em> with products to show. The horror! 3 renders! (you could get it down to 2 if you skip straight to the ‚Äúloading‚Äù state)</p>

<p>You may be worried about unnecessary renders because of performance, but don‚Äôt be: single renders are very fast. If you‚Äôre working on an app where they are slow enough to notice, do some profiling and figure out why that‚Äôs the case.</p>

<p>Think of it this way: the app needs to show <em>something</em> when there are no products, or when they‚Äôre loading, or when there‚Äôs an error. You probably don‚Äôt want to just show a blank screen until the data is ready. This gives you an opportunity to make that user experience shine.</p>

<h2 id="but-the-component-shouldnt-have-to-fetch">But The Component Shouldn‚Äôt Have to Fetch!</h2>

<p>From an architecture standpoint, it would be nicer if there was a parent ‚Äúthing‚Äù (component or function or router or whatever) that automatically fetched data before it loaded the components. Then components could be blissfully unaware of any dirty API nonsense; they could simply wait around to be handed data on a silver platter. What a life!</p>

<p>There are ways to fix this, but as with everything, they come with tradeoffs. Magic data loaders are magic (harder to debug, harder to remember how/when/why they work). They might require <em>more</em> code instead of less.</p>

<h2 id="many-ways-to-solve-data-fetching">Many Ways To Solve Data Fetching</h2>

<p>There are many many ways to factor this code. There is no ‚Äúbest way,‚Äù because these things exist on a spectrum, and because the ‚Äúbest‚Äù for one use case may be the ‚Äúworst‚Äù for another.</p>

<p>‚ÄúFetch the data in <code class="highlighter-rouge">componentDidMount</code>‚Äù is not the <em>one true way</em>, but it‚Äôs simple, and it gets the job done.</p>

<p>If you don‚Äôt like the idea of doing it this way, though, here are some other things you could try:</p>

<ul>
  <li>Move the API call out of the Redux action and into an <code class="highlighter-rouge">api</code> module, and call it from the action. (better separation of concerns)</li>
  <li>Have the component call the API module directly, and then dispatch the action from inside the component when the data comes back, <a href="https://egghead.io/lessons/javascript-redux-dispatching-actions-with-the-fetched-data">like Dan Abramov shows in this video</a>.</li>
  <li>Use a library like <a href="https://github.com/kouhin/redux-dataloader">redux-dataloader</a> or <a href="https://github.com/recruit-tech/redux-async-loader">redux-async-loader</a> or <a href="https://github.com/markerikson/redux-ecosystem-links/blob/master/component-data-fetching-preloading.md">one of the other libraries from Mark Erikson‚Äôs list of data fetching libs</a>.</li>
  <li>Make a wrapper component to do the fetching ‚Äì in the above example, that might be called <code class="highlighter-rouge">ProductListPage</code>. Then the ‚ÄúPage‚Äù takes care of fetching, and the ‚ÄúList‚Äù just accepts data and renders it.</li>
  <li>Use <a href="https://github.com/acdlite/recompose">recompose</a> to pull out the <code class="highlighter-rouge">componentDidMount</code> lifecycle into its own higher-order wrapper component ‚Äì and although the library will keep working, it seems its creator has decided to stop working on it in light of <a href="/intro-to-hooks/">React‚Äôs new hooks feature</a>.</li>
  <li>Soon (or maybe even now) you‚Äôll be able to use React‚Äôs built-in Suspense feature to fetch and cache data.</li>
</ul>

<p>Like I said, there are a lot of ways to do this :)</p>

<h2 id="working-code-example">Working Code Example</h2>

<p>Check out <a href="https://codesandbox.io/s/j3378m4v3y">this CodeSandbox</a> to see a working version of this app.</p>

<p>Since there‚Äôs no server to handle the request here, I wrote a <code class="highlighter-rouge">fakeFetchProducts</code> function to fake a delay and then return the data. This way you can see how the loading indicator works without having to set up a server.</p>

<h2 id="action-steps">Action Steps</h2>

<p>Try implementing this yourself! Practice is the best way to learn.</p>

<p>If you don‚Äôt have your own backend server, just use Reddit ‚Äì their URLs will return JSON if you append ‚Äú.json‚Äù to the end, e.g. <a href="https://www.reddit.com/r/reactjs.json">www.reddit.com/r/reactjs.json</a>.</p>

<p>Here‚Äôs an exercise for you: Make a tiny React + Redux app that displays the posts from /r/reactjs.</p>

        
          <div class="end-post-book">
  <p>
    Learning React can be a struggle -- so many libraries and tools!<br/>
    My advice? Ignore all of them :)<br/>
    For a step-by-step approach, read my book <a href="https://daveceddia.com/pure-react/?utm_campaign=after-post">Pure React</a>.
  </p>
  <div style="text-align: left;font-size:14px;font-family: 'Open Sans',sans-serif;background-color: #fff;padding: 10px;border-radius: 2px;box-sizing: border-box;width: 70%;margin: 0 auto;background: #ecf5f9;">
    <div>
      Loved it! Very well written and put together. Love that you focused only on React. Wish I had stumbled onto your book first before I messed around with all those scary "boilerplate" projects.
    </div>
    <div class="person">
      <div class="person--name" style="font-weight:600;">‚Äî John Lyon-Smith</div>
    </div>
  </div>
</div>

        
        
          













<div>
  <div class="dc_form_container ">
    <div class="dc_success_msg" style="display:none;">
      Success! Now check your email.
    </div>

    <!--  Form starts here  -->
    <form class="dc_signup_form" action="/s/signup" method="POST">
      <h4 class="dc_title">
Learn the basics of React in 5 days
</h4>
      <div class="dc_description">
        
<div>
  <p>Finally understand how React works! You will:</p>
  <div class="prec-bullet">üéâ Get something on screen</div>
  <div class="prec-bullet">üíÑ Write dynamic components</div>
  <div class="prec-bullet">üèÉ Make it interactive</div>
  <div class="prec-bullet">üòé Fetch real data</div>
  <p class="prec-bullet">üõ≥ Put it online</p>
  <p>5 days, 5 emails. Walk away with the basics and a plan!</p>
  <p style="text-align:center;">Get Lesson 1 right now üëá </p>
</div>

      </div>

      <div class="dc_error_msg" style="display:none">
        There was an error submitting your subscription. Please try again.
      </div>

      <div class="dc_field">
        <label class="dc_label" for="dc_email" style="display: none">Email Address</label>
        <input type="email" name="email" placeholder="Your email address" required="">
      </div>
      <div class="dc_form_field" style="position: absolute !important;left: -999em !important;">
        <input type="text" name="last_name" />
      </div>
      <input type="hidden" name="page_id" value="where-fetch-data-redux" />
      <input type="hidden" name="form_id" value="pure-react-email-course" />
      <input type="hidden" name="form_version" value="3" />
      <input type="hidden" name="tag" value="734384" />
      <button class="dc_subscribe_button">
        Send Me Lesson 1
      </button>
      <div class="dc_guarantee">
        I respect your email privacy. Unsubscribe any time.
      </div>
    </form>

    <form class="dc_gdpr_form" action="/s/signup/gdpr" method="POST" style="display:none;">
  <p>Before we go on, I have to ask...</p>
  <div class="dc_form_field">
    <label>
      <input type="checkbox" name="confirm_answer" value="true"/>
      <span>consent</span>
    </label>
  </div>
  <br/>

  <div class="dc_error_msg" style="display:none">
    There was an error submitting your subscription. Please try again.
  </div>

  <input type="hidden" name="email" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="firstName" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="gdpr" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="captcha" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="sign" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="confirm" value="FILL_IN_WITH_JS" />
  <input type="hidden" name="tag" value="734384" />
  <input type="hidden" name="page_id" value="where-fetch-data-redux" />
  <input type="hidden" name="form_id" value="pure-react-email-course" />
  <input type="hidden" name="form_version" value="3" />
  <button class="dc_subscribe_button">
    Finish
  </button>
</form>

  </div>

  <style type="text/css">
    .dc_form_container {
      border-top: 4px solid #3166de;
      border-bottom: 4px solid #3166de;
      padding: 1em;
      background: #f8faff;
      font-family: "Open Sans", sans-serif;
      margin-bottom: 2.5rem;
    }
    .dc_form_container .dc_title {
      margin-top: 0;
      text-align: center;
      font-weight: 400;
      font-size: 30px;
    }
    .dc_form_container .dc_description {
      margin-bottom: 10px;
    }
    .dc_signup_form, .dc_gdpr_form {
      margin-bottom: 0;
      position: relative;
    }
    .dc_signup_form input, .dc_gdpr_form input {
      width: 100%;
      padding: 20px 12px;
    }
    .dc_gdpr_form input[type="checkbox"] {
      width: initial;
      margin: 0;
      margin-right: 5px;
    }
    .dc_subscribe_button {
      margin: 0 auto;
      display: block;
      width: 100%;
      max-width: 250px;
      font-size: 18px;
      background: orange;
      color: #fff;
      border-color: #e29609;
      height: auto;
      margin-bottom: 5px;
    }
    .dc_subscribe_button[disabled] {
      opacity: 0.5;
    }
    .dc_subscribe_button[disabled]:hover {
      opacity: 0.5;
      color: #fff;
    }
    .dc_guarantee {
      font-size: 12px;
      text-align: center;
      opacity: 0.7;
    }
    .dc_success_msg {
      padding: 10px;
      background: #fff;
      border: 1px solid #8dc74a;
      border-radius: 2px;
      background: #F1F8E9;
      text-align: center;
    }
    .dc_error_msg {
      background: #FFEBEE;
      padding: 10px;
      margin-bottom: 5px;
      border: 2px solid #C62828;
    }
  </style>
</div>


<style>
img.dc_form_img {
  margin: 0 auto;
  margin-bottom: 10px;
}
.prec-bullet {
  margin-left: 15px;
}
</style>

        
        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'daveceddia'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="https://daveceddia.com/hot-reloading-create-react-app/" class="btn" title="Hot Reloading in Create React App Without Ejecting">Previous</a>
      
      
        <a href="https://daveceddia.com/love-js-hate-css/" class="btn" title="Love JavaScript, but hate CSS?">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper muted-centered">
  <footer role="contentinfo">
    

<span>&copy; 2019 Dave Ceddia.</span>
<div class="social-icons">
	<a href="http://twitter.com/dceddia" title="Dave Ceddia on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	<a href="http://plus.google.com/+dceddia" title="Dave Ceddia on Google+" target="_blank"><i class="fa fa-google-plus-square fa-2x"></i></a>
	
	
	
	
	<a href="http://github.com/dceddia" title="Dave Ceddia on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="https://daveceddia.com/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'https://daveceddia.com';
</script>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://daveceddia.com/assets/js/scripts.min.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82635227-1', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid');
  ga('send', 'pageview');

</script>


<!-- Asynchronous Clicky tracking code-->
<script type="text/javascript">
var clicky_site_ids = clicky_site_ids || [];
clicky_site_ids.push(100838734);
(function() {
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = '//static.getclicky.com/js';
  ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild( s );
})();
</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100838734ns.gif" /></p></noscript>


<script>
$(function() {
  $('.click-to-show').click(function(e) {
    $(e.target).parent('.click-to-show').find('.highlight').toggle();
  });
});

function signupClicked() {
  // if(window.clicky){ window.clicky.goal('Newsletter Signup'); }
}
function inlineSignupClicked() {
  // if(window.clicky){ window.clicky.goal('[Inline] Newsletter Signup'); }
}
function testingInlineClicked() {
  // if(window.clicky){ window.clicky.goal('[Inline, Testing] Newsletter Signup'); }
}
</script>

<script src="//load.sumome.com/" data-sumo-site-id="e237fc3d7a2f1c8c986e03b6b4e1f5c1689d5e40133932e1f546a3748d5d6747" async="async"></script>

</body>
</html>
